<%- include('partials/header', {
      title: 'sensors',
      tailwind: true,
      bodyClass: 'bg-black text-gray-300 font-sans'
    }) %>

<main class="max-w-2xl mx-auto p-8 space-y-8">
  <h1 class="text-3xl text-gray-400">Chat</h2>
  
  <div id="chatContainer" class="border p-4 h-96 overflow-y-scroll bg-gray-900 text-white">
  
  </div>

  <form onsubmit="return sendMessage(event)">
    <input type="text" id="message" placeholder="Enter message">
    <button id="sendBtn" class="btn">Send</button>
  </form>
</main>

<script>
      async function sendMessage(event) {
        event.preventDefault();
        const input = document.getElementById("message");
        const message = input.value.trim();
        if (!message) return;
        
        // Send message to the server
        const response = await fetch("/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          credentials: "include",
          body: JSON.stringify({ message })
        });
        
        if (response.ok) {
          const result = await response.json();
          // Append the new message to the chat container
          appendMessage(result.username, result.message);
          input.value = "";
        } else {
          console.error("Failed to send message");
        }
      }

        function appendMessage(username, message) {
          const container = document.getElementById("chatContainer");
          const div = document.createElement("div");
          div.textContent = `${username}: ${message}`;
          container.appendChild(div);
          // Scroll to the bottom
          container.scrollTop = container.scrollHeight;
        }
    </script>


<%- include('partials/footer') %>

